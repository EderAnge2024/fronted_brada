import{d as te,r,j as e}from"./index-DM_27y1d.js";const se="_container_rtwhv_1",ie="_sectionTitle_rtwhv_15",oe="_formSection_rtwhv_29",re="_form_rtwhv_29",le="_formGroup_rtwhv_57",ce="_formInput_rtwhv_79",de="_primaryButton_rtwhv_107",me="_listSection_rtwhv_139",pe="_imageGrid_rtwhv_153",ge="_imageCard_rtwhv_167",ue="_imageInfo_rtwhv_193",he="_urlText_rtwhv_211",_e="_imagePreview_rtwhv_225",ve="_actions_rtwhv_259",xe="_editButton_rtwhv_269",we="_deleteButton_rtwhv_297",be="_modalOverlay_rtwhv_325",je="_modalContent_rtwhv_351",fe="_closeButton_rtwhv_371",Ie="_modalActions_rtwhv_403",Ne="_secondaryButton_rtwhv_417",Ce="_fileUploadContainer_rtwhv_483",ye="_fileInput_rtwhv_507",Le="_fileHint_rtwhv_523",Se="_urlHint_rtwhv_535",Te="_previewContainer_rtwhv_551",Be="_imagePreviewWrapper_rtwhv_571",Pe="_removePreviewBtn_rtwhv_601",Ue="_separator_rtwhv_647",Ee="_uploadProgress_rtwhv_693",De="_progressBar_rtwhv_715",Re="_progressFill_rtwhv_731",ke="_cardImage_rtwhv_757",Fe="_currentImageContainer_rtwhv_775",Ge="_currentImage_rtwhv_775",Ae="_subTitle_rtwhv_853",Oe="_noLogoSection_rtwhv_945",ze="_warningText_rtwhv_963",He="_checkboxLabel_rtwhv_979",$e="_hint_rtwhv_1007",We="_tabContainer_rtwhv_1021",qe="_tab_rtwhv_1021",Ye="_activeTab_rtwhv_1067",Je="_tabContent_rtwhv_1079",Me="_principalCard_rtwhv_1089",Ve="_principalBadge_rtwhv_1101",Ke="_principalButton_rtwhv_1131",Qe="_emptyState_rtwhv_1173",a={container:se,sectionTitle:ie,formSection:oe,form:re,formGroup:le,formInput:ce,primaryButton:de,listSection:me,imageGrid:pe,imageCard:ge,imageInfo:ue,urlText:he,imagePreview:_e,actions:ve,editButton:xe,deleteButton:we,modalOverlay:be,modalContent:je,closeButton:fe,modalActions:Ie,secondaryButton:Ne,fileUploadContainer:Ce,fileInput:ye,fileHint:Le,urlHint:Se,previewContainer:Te,imagePreviewWrapper:Be,removePreviewBtn:Pe,separator:Ue,uploadProgress:Ee,progressBar:De,progressFill:Re,cardImage:ke,currentImageContainer:Fe,currentImage:Ge,subTitle:Ae,noLogoSection:Oe,warningText:ze,checkboxLabel:He,hint:$e,tabContainer:We,tab:qe,activeTab:Ye,tabContent:Je,principalCard:Me,principalBadge:Ve,principalButton:Ke,emptyState:Qe},ea=()=>{const{addImagen:B,fetchImagen:l,imagenes:z,deleteImagen:H,updateImagen:P,setLogoPrincipal:_,getLogoPrincipal:$,getLogos:U}=te(),[g,w]=r.useState(null),[d,E]=r.useState({Tipo_Imagen:"",URL:"",es_principal:!1}),[c,b]=r.useState({Tipo_Imagen:"",URL:"",es_principal:!1}),[v,j]=r.useState(null),[i,p]=r.useState(!1),[Xe,D]=r.useState(0),[R,f]=r.useState(""),[I,u]=r.useState(null),[N,h]=r.useState(""),[x,k]=r.useState("logos"),W="bradatec",q="davbpytad";r.useEffect(()=>{l()},[l]);const C=U(),Y=$(),y=z.filter(n=>n.Tipo_Imagen==="Banner"),J=n=>{const t=n.target.files[0];if(t){j(t);const s=new FileReader;s.onload=o=>f(o.target.result),s.readAsDataURL(t)}},M=n=>{const t=n.target.files[0];if(t){u(t);const s=new FileReader;s.onload=o=>h(o.target.result),s.readAsDataURL(t)}},F=async n=>{const t=new FormData;t.append("file",n),t.append("upload_preset",W);try{const s=await fetch(`https://api.cloudinary.com/v1_1/${q}/image/upload`,{method:"POST",body:t});if(!s.ok)throw new Error("Error al subir imagen a Cloudinary");return(await s.json()).secure_url}catch(s){throw console.error("Error en upload:",s),s}},L=n=>{const{name:t,value:s,type:o,checked:m}=n.target;E({...d,[t]:o==="checkbox"?m:s})},V=async n=>{n.preventDefault(),p(!0),D(0);try{let t={...d};if(v){const o=await F(v);t.URL=o}if(console.log("📋 Datos a enviar:",t),t.Tipo_Imagen==="Logo"&&t.es_principal){const o={...t,es_principal:!1};console.log("🎯 Agregando logo primero sin marcar como principal...");const m=await B(o);if(await l(),m)console.log("🎯 Estableciendo como principal el ID:",m),await _(m);else{await new Promise(ne=>setTimeout(ne,300)),await l();const O=U(),T=O[O.length-1];T&&(console.log("🎯 Estableciendo como principal (backup):",T.ID_Imagen),await _(T.ID_Imagen))}}else await B(t);E({Tipo_Imagen:"",URL:"",es_principal:!1}),j(null),f("");const s=document.querySelector('input[type="file"]');s&&(s.value=""),await l(),console.log("✅ Imagen agregada exitosamente")}catch(t){console.error("❌ Error al agregar imagen:",t),alert("Error al subir la imagen: "+t.message)}finally{p(!1),D(0)}},K=async n=>{if(window.confirm("¿Estás seguro de eliminar esta imagen?"))try{await H(n),await l()}catch(t){console.error("Error al eliminar imagen:",t)}},Q=n=>{w(n),b({Tipo_Imagen:n.Tipo_Imagen,URL:n.URL,es_principal:n.es_principal||!1}),u(null),h("")},S=n=>{const{name:t,value:s,type:o,checked:m}=n.target;b({...c,[t]:o==="checkbox"?m:s})},X=async()=>{p(!0);try{let n={...c};if(I){const t=await F(I);n.URL=t}if(console.log("📋 Datos de actualización:",n),n.Tipo_Imagen==="Logo"&&n.es_principal&&!g.es_principal){const t={...n,es_principal:!1};await P(g.ID_Imagen,t),await l(),await _(g.ID_Imagen)}else await P(g.ID_Imagen,n);await l(),w(null),u(null),h(""),console.log("✅ Imagen actualizada exitosamente")}catch(n){console.error("❌ Error al actualizar imagen:",n),alert("Error al actualizar la imagen: "+n.message)}finally{p(!1)}},G=()=>{w(null),b({Tipo_Imagen:"",URL:"",es_principal:!1}),u(null),h("")},Z=()=>{j(null),f("");const n=document.querySelector('input[type="file"]');n&&(n.value="")},ee=()=>{u(null),h("")},ae=async n=>{if(window.confirm("¿Deseas cambiar el logo principal?"))try{p(!0),console.log("🎯 Iniciando cambio de logo principal desde ImagenForm:",n),await _(n),await new Promise(s=>setTimeout(s,500)),await l();const t=new CustomEvent("logoChanged",{detail:{logoId:n,timestamp:Date.now(),source:"ImagenForm"}});window.dispatchEvent(t),console.log("📢 Evento logoChanged disparado:",t.detail),setTimeout(async()=>{await l(),console.log("🔄 Segunda actualización completada")},1e3),alert("✅ Logo principal actualizado correctamente. El cambio se reflejará en toda la aplicación.")}catch(t){console.error("❌ Error al cambiar logo principal:",t),alert("❌ Error al cambiar logo principal: "+t.message)}finally{p(!1)}},A=(n,t=!1)=>e.jsxs("div",{className:`${a.imageCard} ${n.es_principal?a.principalCard:""}`,children:[n.es_principal&&e.jsx("div",{className:a.principalBadge,children:"⭐ Logo Principal"}),e.jsxs("div",{className:a.imageInfo,children:[e.jsx("h3",{children:n.Tipo_Imagen}),e.jsx("p",{className:a.urlText,children:n.URL}),n.URL&&e.jsx("div",{className:a.imagePreview,children:e.jsx("img",{src:n.URL,alt:n.Tipo_Imagen,className:a.cardImage,onError:s=>{s.target.style.display="none"}})})]}),e.jsxs("div",{className:a.actions,children:[t&&!n.es_principal&&e.jsx("button",{onClick:()=>ae(n.ID_Imagen),className:a.principalButton,disabled:i,children:"Hacer Principal"}),e.jsx("button",{onClick:()=>Q(n),className:a.editButton,disabled:i,children:"Editar"}),e.jsx("button",{onClick:()=>K(n.ID_Imagen),className:a.deleteButton,disabled:i,children:"Eliminar"})]})]},n.ID_Imagen);return e.jsx("div",{className:a.ImagenFrom,children:e.jsxs("div",{className:a.container,children:[e.jsxs("div",{className:a.formSection,children:[e.jsx("h1",{className:a.sectionTitle,children:"Gestión de Imágenes"}),!Y&&e.jsxs("div",{className:a.noLogoSection,children:[e.jsx("h2",{className:a.subTitle,children:"⚠️ Sin Logo Principal"}),e.jsx("p",{className:a.warningText,children:"No hay un logo principal configurado. Selecciona un logo y márcalo como principal para que aparezca en la aplicación."})]}),e.jsxs("form",{onSubmit:V,className:a.form,children:[e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Tipo de Imagen"}),e.jsxs("select",{required:!0,name:"Tipo_Imagen",value:d.Tipo_Imagen,onChange:L,className:a.formInput,disabled:i,children:[e.jsx("option",{value:"",children:"Seleccione tipo de imagen"}),e.jsx("option",{value:"Logo",children:"Logo"}),e.jsx("option",{value:"Banner",children:"Banner"})]})]}),d.Tipo_Imagen==="Logo"&&e.jsxs("div",{className:a.formGroup,children:[e.jsxs("label",{className:a.checkboxLabel,children:[e.jsx("input",{type:"checkbox",name:"es_principal",checked:d.es_principal,onChange:L,disabled:i}),"Establecer como logo principal"]}),e.jsx("p",{className:a.hint,children:"Solo puede haber un logo principal a la vez"})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Subir Imagen"}),e.jsxs("div",{className:a.fileUploadContainer,children:[e.jsx("input",{type:"file",accept:"image/*",onChange:J,className:a.fileInput,disabled:i}),e.jsx("p",{className:a.fileHint,children:"Selecciona una imagen (JPG, PNG, GIF, etc.)"})]})]}),R&&e.jsxs("div",{className:a.previewContainer,children:[e.jsx("label",{children:"Vista previa:"}),e.jsxs("div",{className:a.imagePreviewWrapper,children:[e.jsx("img",{src:R,alt:"Preview",className:a.imagePreview}),e.jsx("button",{type:"button",onClick:Z,className:a.removePreviewBtn,disabled:i,children:"❌"})]})]}),e.jsx("div",{className:a.separator,children:e.jsx("span",{children:"O"})}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"URL de la Imagen (opcional)"}),e.jsx("input",{type:"url",placeholder:"https://ejemplo.com/imagen.jpg",name:"URL",value:d.URL,onChange:L,className:a.formInput,disabled:i||v!==null}),e.jsx("p",{className:a.urlHint,children:"Solo se usará si no has seleccionado un archivo"})]}),i&&e.jsxs("div",{className:a.uploadProgress,children:[e.jsx("p",{children:"Subiendo imagen..."}),e.jsx("div",{className:a.progressBar,children:e.jsx("div",{className:a.progressFill})})]}),e.jsx("button",{type:"submit",className:a.primaryButton,disabled:i||!v&&!d.URL,children:i?"Subiendo...":"Guardar Imagen"})]})]}),e.jsxs("div",{className:a.listSection,children:[e.jsx("h2",{className:a.sectionTitle,children:"Imágenes Registradas"}),e.jsxs("div",{className:a.tabContainer,children:[e.jsxs("button",{className:`${a.tab} ${x==="logos"?a.activeTab:""}`,onClick:()=>k("logos"),children:["Logos (",C.length,")"]}),e.jsxs("button",{className:`${a.tab} ${x==="banners"?a.activeTab:""}`,onClick:()=>k("banners"),children:["Banners (",y.length,")"]})]}),e.jsxs("div",{className:a.tabContent,children:[x==="logos"&&e.jsx("div",{className:a.imageGrid,children:C.length>0?C.map(n=>A(n,!0)):e.jsx("div",{className:a.emptyState,children:e.jsx("p",{children:"No hay logos registrados"})})}),x==="banners"&&e.jsx("div",{className:a.imageGrid,children:y.length>0?y.map(n=>A(n,!1)):e.jsx("div",{className:a.emptyState,children:e.jsx("p",{children:"No hay banners registrados"})})})]})]}),g&&e.jsx("div",{className:a.modalOverlay,children:e.jsxs("div",{className:a.modalContent,children:[e.jsx("button",{onClick:G,className:a.closeButton,disabled:i,children:"×"}),e.jsx("h3",{children:"Editar Imagen"}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Tipo de Imagen"}),e.jsxs("select",{name:"Tipo_Imagen",value:c.Tipo_Imagen,onChange:S,className:a.formInput,disabled:i,children:[e.jsx("option",{value:"",children:"Seleccione tipo de imagen"}),e.jsx("option",{value:"Logo",children:"Logo"}),e.jsx("option",{value:"Banner",children:"Banner"})]})]}),c.Tipo_Imagen==="Logo"&&e.jsx("div",{className:a.formGroup,children:e.jsxs("label",{className:a.checkboxLabel,children:[e.jsx("input",{type:"checkbox",name:"es_principal",checked:c.es_principal,onChange:S,disabled:i}),"Establecer como logo principal"]})}),c.URL&&!N&&e.jsxs("div",{className:a.currentImageContainer,children:[e.jsx("label",{children:"Imagen actual:"}),e.jsx("img",{src:c.URL,alt:"Imagen actual",className:a.currentImage})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Cambiar Imagen"}),e.jsx("input",{type:"file",accept:"image/*",onChange:M,className:a.fileInput,disabled:i})]}),N&&e.jsxs("div",{className:a.previewContainer,children:[e.jsx("label",{children:"Nueva imagen:"}),e.jsxs("div",{className:a.imagePreviewWrapper,children:[e.jsx("img",{src:N,alt:"Preview",className:a.imagePreview}),e.jsx("button",{type:"button",onClick:ee,className:a.removePreviewBtn,disabled:i,children:"❌"})]})]}),e.jsx("div",{className:a.separator,children:e.jsx("span",{children:"O"})}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"URL"}),e.jsx("input",{type:"url",name:"URL",value:c.URL,onChange:S,placeholder:"https://ejemplo.com/imagen.jpg",className:a.formInput,disabled:i||I!==null})]}),i&&e.jsxs("div",{className:a.uploadProgress,children:[e.jsx("p",{children:"Actualizando imagen..."}),e.jsx("div",{className:a.progressBar,children:e.jsx("div",{className:a.progressFill})})]}),e.jsxs("div",{className:a.modalActions,children:[e.jsx("button",{onClick:X,className:a.primaryButton,disabled:i,children:i?"Subiendo...":"Guardar Cambios"}),e.jsx("button",{onClick:G,className:a.secondaryButton,disabled:i,children:"Cancelar"})]})]})})]})})};export{ea as default};
