import{e as z,f as Y,r as d,j as e}from"./index-DM_27y1d.js";const $="_container_vhm6c_3",J="_formSection_vhm6c_19",V="_listSection_vhm6c_27",K="_title_vhm6c_35",Q="_form_vhm6c_19",X="_input_vhm6c_79",Z="_select_vhm6c_79",ee="_submitButton_vhm6c_145",ae="_productList_vhm6c_203",te="_productCard_vhm6c_217",ne="_productInfo_vhm6c_251",se="_productName_vhm6c_259",oe="_label_vhm6c_291",re="_imageContainer_vhm6c_309",ie="_productImage_vhm6c_319",le="_actionButtons_vhm6c_337",ce="_deleteButton_vhm6c_353",de="_editButton_vhm6c_353",ue="_modalOverlay_vhm6c_435",me="_modalWindow_vhm6c_463",pe="_modalClose_vhm6c_489",_e="_modalTitle_vhm6c_535",he="_modalForm_vhm6c_553",ge="_modalButtons_vhm6c_565",ve="_saveButton_vhm6c_581",xe="_cancelButton_vhm6c_581",Ce="_configAlert_vhm6c_653",je="_formGroup_vhm6c_669",be="_fileUploadContainer_vhm6c_677",Ne="_fileInput_vhm6c_693",Pe="_fileHint_vhm6c_701",fe="_urlHint_vhm6c_701",De="_previewContainer_vhm6c_713",ye="_imagePreviewWrapper_vhm6c_721",Ie="_imagePreview_vhm6c_721",we="_removePreviewBtn_vhm6c_745",Ue="_separator_vhm6c_769",Be="_uploadProgress_vhm6c_813",Se="_progressBar_vhm6c_821",Fe="_progressFill_vhm6c_837",Ee="_currentImageContainer_vhm6c_863",Ae="_currentImage_vhm6c_863",a={container:$,formSection:J,listSection:V,title:K,form:Q,input:X,select:Z,submitButton:ee,productList:ae,productCard:te,productInfo:ne,productName:se,label:oe,imageContainer:re,productImage:ie,actionButtons:le,deleteButton:ce,editButton:de,modalOverlay:ue,modalWindow:me,modalClose:pe,modalTitle:_e,modalForm:he,modalButtons:ge,saveButton:ve,cancelButton:xe,configAlert:Ce,formGroup:je,fileUploadContainer:be,fileInput:Ne,fileHint:Pe,urlHint:fe,previewContainer:De,imagePreviewWrapper:ye,imagePreview:Ie,removePreviewBtn:we,separator:Ue,uploadProgress:Be,progressBar:Se,progressFill:Fe,currentImageContainer:Ee,currentImage:Ae},Oe=()=>{const{addProducto:B,fetchProducto:g,productos:S,deleteProducto:F,updateProducto:E}=z(),{categorias:N,fetchCategoria:A}=Y(),[P,v]=d.useState(null),[i,f]=d.useState({ID_Categoria:"",Codigo:"",Nombre_Producto:"",Descripcion:"",Descuento:"",Precio_Producto:"",Marca:"",Cantidad:"",cantidad_Disponible:"",Url:"",Precio_Final:""}),[r,D]=d.useState({ID_Categoria:"",Codigo:"",Nombre_Producto:"",Descripcion:"",Descuento:"",Precio_Producto:"",Marca:"",Cantidad:"",cantidad_Disponible:"",Url:"",Precio_Final:""}),[_,x]=d.useState(null),[y,C]=d.useState(""),[j,m]=d.useState(null),[b,p]=d.useState(""),[n,h]=d.useState(!1),[Le,I]=d.useState(0),L="bradatec",M="davbpytad";d.useEffect(()=>{g(),A()},[]);const w=async t=>{const s=new FormData;s.append("file",t),s.append("upload_preset",L);try{const o=await fetch(`https://api.cloudinary.com/v1_1/${M}/image/upload`,{method:"POST",body:s});if(!o.ok)throw new Error("Error al subir imagen a Cloudinary");return(await o.json()).secure_url}catch(o){throw console.error("Error en upload:",o),o}},O=t=>{const s=t.target.files[0];if(s){x(s);const o=new FileReader;o.onload=u=>C(u.target.result),o.readAsDataURL(s)}},q=t=>{const s=t.target.files[0];if(s){m(s);const o=new FileReader;o.onload=u=>p(u.target.result),o.readAsDataURL(s)}},R=()=>{x(null),C("");const t=document.querySelector('input[type="file"]');t&&(t.value="")},G=()=>{m(null),p("")},l=t=>{const{name:s,value:o}=t.target;f({...i,[s]:o})},T=async t=>{t.preventDefault(),h(!0),I(0);try{let s={...i};if(_){const u=await w(_);s.Url=u}await B(s),f({ID_Categoria:"",Codigo:"",Nombre_Producto:"",Descripcion:"",Descuento:"",Precio_Producto:"",Marca:"",Cantidad:"",cantidad_Disponible:"",Url:"",Precio_Final:""}),x(null),C("");const o=document.querySelector('input[type="file"]');o&&(o.value=""),alert("Se agreg√≥ el producto nuevo")}catch(s){console.error("Error al agregar producto:",s),alert("Error al agregar el producto. Por favor, verifica tu configuraci√≥n de Cloudinary.")}finally{h(!1),I(0)}},k=t=>{window.confirm("¬øEst√°s seguro de que deseas eliminar este producto?")&&(F(t),g())},W=t=>{v(t),D({ID_Categoria:t.ID_Categoria,Codigo:t.Codigo,Nombre_Producto:t.Nombre_Producto,Descripcion:t.Descripcion,Descuento:t.Descuento,Precio_Producto:t.Precio_Producto,Marca:t.Marca,Cantidad:t.Cantidad,cantidad_Disponible:t.cantidad_Disponible,Url:t.Url,Precio_Final:t.Precio_Final}),m(null),p("")},c=t=>{const{name:s,value:o}=t.target;D({...r,[s]:o})},H=async()=>{h(!0);try{let t={...r};if(j){const s=await w(j);t.Url=s}await E(P.ID_Producto,t),v(null),m(null),p(""),g(),alert("Producto actualizado exitosamente")}catch(t){console.error("Error al actualizar producto:",t),alert("Error al actualizar el producto.")}finally{h(!1)}},U=()=>{v(null),m(null),p("")};return e.jsxs("div",{className:a.container,children:[e.jsxs("div",{className:a.formSection,children:[e.jsx("h1",{className:a.title,children:"Agregar Producto"}),e.jsxs("div",{className:a.configAlert,children:[e.jsx("p",{children:e.jsx("strong",{children:"‚ö†Ô∏è Configuraci√≥n necesaria:"})}),e.jsx("p",{children:"Aseg√∫rate de configurar tu CLOUDINARY_CLOUD_NAME y CLOUDINARY_UPLOAD_PRESET en el componente."})]}),e.jsxs("form",{onSubmit:T,className:a.form,children:[e.jsxs("select",{name:"ID_Categoria",value:i.ID_Categoria,onChange:l,required:!0,className:a.select,disabled:n,children:[e.jsx("option",{value:"",children:"-- Seleccionar categor√≠a --"}),N.map(t=>e.jsx("option",{value:t.ID_Categoria,children:t.Tipo_Producto},t.ID_Categoria))]}),e.jsx("input",{type:"text",placeholder:"C√≥digo del producto",required:!0,name:"Codigo",value:i.Codigo,onChange:l,className:a.input,disabled:n}),e.jsx("input",{type:"text",placeholder:"Nombre del producto",required:!0,name:"Nombre_Producto",value:i.Nombre_Producto,onChange:l,className:a.input,disabled:n}),e.jsx("input",{type:"text",placeholder:"Descripci√≥n",required:!0,name:"Descripcion",value:i.Descripcion,onChange:l,className:a.input,disabled:n}),e.jsx("input",{type:"number",placeholder:"Descuento (%)",required:!0,name:"Descuento",value:i.Descuento,onChange:l,className:a.input,min:"0",max:"100",disabled:n}),e.jsx("input",{type:"number",placeholder:"Precio del producto",required:!0,name:"Precio_Producto",value:i.Precio_Producto,onChange:l,className:a.input,min:"0",step:"0.01",disabled:n}),e.jsx("input",{type:"text",placeholder:"Marca",required:!0,name:"Marca",value:i.Marca,onChange:l,className:a.input,disabled:n}),e.jsx("input",{type:"number",placeholder:"Cantidad total",required:!0,name:"Cantidad",value:i.Cantidad,onChange:l,className:a.input,min:"0",disabled:n}),e.jsx("input",{type:"number",placeholder:"Cantidad disponible",required:!0,name:"cantidad_Disponible",value:i.cantidad_Disponible,onChange:l,className:a.input,min:"0",disabled:n}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Imagen del Producto"}),e.jsxs("div",{className:a.fileUploadContainer,children:[e.jsx("input",{type:"file",accept:"image/*",onChange:O,className:a.fileInput,disabled:n}),e.jsx("p",{className:a.fileHint,children:"Selecciona una imagen (JPG, PNG, GIF, etc.)"})]})]}),y&&e.jsxs("div",{className:a.previewContainer,children:[e.jsx("label",{children:"Vista previa:"}),e.jsxs("div",{className:a.imagePreviewWrapper,children:[e.jsx("img",{src:y,alt:"Preview",className:a.imagePreview}),e.jsx("button",{type:"button",onClick:R,className:a.removePreviewBtn,disabled:n,children:"‚ùå"})]})]}),e.jsx("div",{className:a.separator,children:e.jsx("span",{children:"O"})}),e.jsx("input",{type:"url",placeholder:"URL de la imagen (opcional)",name:"Url",value:i.Url,onChange:l,className:a.input,disabled:n||_!==null}),e.jsx("p",{className:a.urlHint,children:"Solo se usar√° si no has seleccionado un archivo"}),e.jsx("input",{type:"number",placeholder:"Precio final",required:!0,name:"Precio_Final",value:i.Precio_Final,onChange:l,className:a.input,min:"0",step:"0.01",disabled:n}),n&&e.jsxs("div",{className:a.uploadProgress,children:[e.jsx("p",{children:"Subiendo imagen y guardando producto..."}),e.jsx("div",{className:a.progressBar,children:e.jsx("div",{className:a.progressFill})})]}),e.jsx("button",{type:"submit",className:a.submitButton,disabled:n||!_&&!i.Url,children:n?"Guardando...":"Guardar Producto"})]})]}),e.jsxs("div",{className:a.listSection,children:[e.jsx("h1",{className:a.title,children:"Lista de Productos"}),e.jsx("div",{className:a.productList,children:S.map(t=>e.jsxs("div",{className:a.productCard,children:[e.jsxs("div",{className:a.productInfo,children:[e.jsx("p",{className:a.productName,children:e.jsx("strong",{children:t.Nombre_Producto})}),e.jsxs("p",{children:[e.jsx("span",{className:a.label,children:"C√≥digo:"})," ",t.Codigo]}),e.jsxs("p",{children:[e.jsx("span",{className:a.label,children:"Descripci√≥n:"})," ",t.Descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:a.label,children:"Marca:"})," ",t.Marca]}),e.jsxs("p",{children:[e.jsx("span",{className:a.label,children:"Precio:"})," $",t.Precio_Producto]}),e.jsxs("p",{children:[e.jsx("span",{className:a.label,children:"Descuento:"})," ",t.Descuento,"%"]}),e.jsxs("p",{children:[e.jsx("span",{className:a.label,children:"Precio Final:"})," $",t.Precio_Final]}),e.jsxs("p",{children:[e.jsx("span",{className:a.label,children:"Cantidad Total:"})," ",t.Cantidad]}),e.jsxs("p",{children:[e.jsx("span",{className:a.label,children:"Disponible:"})," ",t.cantidad_Disponible]}),t.Url&&e.jsx("div",{className:a.imageContainer,children:e.jsx("img",{src:t.Url,alt:t.Nombre_Producto,className:a.productImage,onError:s=>{s.target.style.display="none"}})})]}),e.jsxs("div",{className:a.actionButtons,children:[e.jsx("button",{onClick:()=>k(t.ID_Producto),className:a.deleteButton,disabled:n,children:"üóëÔ∏è Eliminar"}),e.jsx("button",{onClick:()=>W(t),className:a.editButton,disabled:n,children:"‚úèÔ∏è Editar"})]})]},t.ID_Producto))})]}),P&&e.jsx("div",{className:a.modalOverlay,children:e.jsxs("div",{className:a.modalWindow,children:[e.jsx("span",{className:a.modalClose,onClick:U,style:{cursor:n?"not-allowed":"pointer"},children:"√ó"}),e.jsx("h3",{className:a.modalTitle,children:"Editar Producto"}),e.jsxs("div",{className:a.modalForm,children:[e.jsxs("select",{name:"ID_Categoria",value:r.ID_Categoria,onChange:c,required:!0,className:a.select,disabled:n,children:[e.jsx("option",{value:"",children:"-- Seleccionar categor√≠a --"}),N.map(t=>e.jsx("option",{value:t.ID_Categoria,children:t.Tipo_Producto},t.ID_Categoria))]}),e.jsx("input",{type:"text",name:"Codigo",value:r.Codigo,onChange:c,placeholder:"C√≥digo del producto",className:a.input,disabled:n}),e.jsx("input",{type:"text",name:"Nombre_Producto",value:r.Nombre_Producto,onChange:c,placeholder:"Nombre del producto",className:a.input,disabled:n}),e.jsx("input",{type:"text",name:"Descripcion",value:r.Descripcion,onChange:c,placeholder:"Descripci√≥n",className:a.input,disabled:n}),e.jsx("input",{type:"number",name:"Descuento",value:r.Descuento,onChange:c,placeholder:"Descuento (%)",className:a.input,min:"0",max:"100",disabled:n}),e.jsx("input",{type:"number",name:"Precio_Producto",value:r.Precio_Producto,onChange:c,placeholder:"Precio del producto",className:a.input,min:"0",step:"0.01",disabled:n}),e.jsx("input",{type:"text",name:"Marca",value:r.Marca,onChange:c,placeholder:"Marca",className:a.input,disabled:n}),e.jsx("input",{type:"number",name:"Cantidad",value:r.Cantidad,onChange:c,placeholder:"Cantidad total",className:a.input,min:"0",disabled:n}),e.jsx("input",{type:"number",name:"cantidad_Disponible",value:r.cantidad_Disponible,onChange:c,placeholder:"Cantidad disponible",className:a.input,min:"0",disabled:n}),r.Url&&!b&&e.jsxs("div",{className:a.currentImageContainer,children:[e.jsx("label",{children:"Imagen actual:"}),e.jsx("img",{src:r.Url,alt:"Imagen actual",className:a.currentImage})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Cambiar Imagen"}),e.jsx("input",{type:"file",accept:"image/*",onChange:q,className:a.fileInput,disabled:n})]}),b&&e.jsxs("div",{className:a.previewContainer,children:[e.jsx("label",{children:"Nueva imagen:"}),e.jsxs("div",{className:a.imagePreviewWrapper,children:[e.jsx("img",{src:b,alt:"Preview",className:a.imagePreview}),e.jsx("button",{type:"button",onClick:G,className:a.removePreviewBtn,disabled:n,children:"‚ùå"})]})]}),e.jsx("div",{className:a.separator,children:e.jsx("span",{children:"O"})}),e.jsx("input",{type:"url",name:"Url",value:r.Url,onChange:c,placeholder:"URL de la imagen",className:a.input,disabled:n||j!==null}),e.jsx("input",{type:"number",name:"Precio_Final",value:r.Precio_Final,onChange:c,placeholder:"Precio final",className:a.input,min:"0",step:"0.01",disabled:n}),n&&e.jsxs("div",{className:a.uploadProgress,children:[e.jsx("p",{children:"Actualizando producto..."}),e.jsx("div",{className:a.progressBar,children:e.jsx("div",{className:a.progressFill})})]}),e.jsxs("div",{className:a.modalButtons,children:[e.jsx("button",{onClick:H,className:a.saveButton,disabled:n,children:n?"Guardando...":"Guardar Cambios"}),e.jsx("button",{onClick:U,className:a.cancelButton,disabled:n,children:"Cancelar"})]})]})]})})]})};export{Oe as default};
