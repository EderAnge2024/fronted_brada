import{q as M,i as J,r as i,j as e}from"./index-DM_27y1d.js";const K="_container_q6ipy_143",Q="_title_q6ipy_157",W="_formSection_q6ipy_185",X="_form_q6ipy_185",Z="_form__select_q6ipy_217",ee="_form__input_q6ipy_219",ae="_form__button_q6ipy_255",te="_listSection_q6ipy_335",re="_projectsGrid_q6ipy_343",se="_projectCard_q6ipy_355",oe="_projectCard__actions_q6ipy_421",ne="_projectCard__button_q6ipy_435",ie="_modal_q6ipy_489",le="_modal__content_q6ipy_537",ce="_modal__close_q6ipy_585",de="_modal__title_q6ipy_629",_e="_modal__input_q6ipy_645",me="_modal__buttons_q6ipy_677",pe="_modal__button_q6ipy_677",ue="_configAlert_q6ipy_745",ge="_imageUploadSection_q6ipy_801",he="_fileLabel_q6ipy_831",je="_fileInput_q6ipy_847",ye="_fileHint_q6ipy_879",fe="_previewContainer_q6ipy_895",be="_previewGrid_q6ipy_927",ve="_previewItem_q6ipy_939",xe="_previewImage_q6ipy_963",Ne="_removeBtn_q6ipy_977",Le="_uploadProgress_q6ipy_1027",Ie="_progressBar_q6ipy_1059",Ce="_progressFill_q6ipy_1077",qe="_projectInfo_q6ipy_1107",we="_projectLink_q6ipy_1115",Ue="_currentImage_q6ipy_1235",Ee="_newPreviewContainer_q6ipy_1393",a={container:K,title:Q,formSection:W,form:X,form__select:Z,form__input:ee,form__button:ae,listSection:te,projectsGrid:re,projectCard:se,projectCard__actions:oe,projectCard__button:ne,"projectCard__button--delete":"_projectCard__button--delete_q6ipy_469",modal:ie,modal__content:le,modal__close:ce,modal__title:de,modal__input:_e,modal__buttons:me,modal__button:pe,"modal__button--cancel":"_modal__button--cancel_q6ipy_723",configAlert:ue,imageUploadSection:ge,fileLabel:he,fileInput:je,fileHint:ye,previewContainer:fe,previewGrid:be,previewItem:ve,previewImage:xe,removeBtn:Ne,uploadProgress:Le,progressBar:Ie,progressFill:Ce,projectInfo:qe,projectLink:we,currentImage:Ue,newPreviewContainer:Ee},Pe=()=>{const{addProyecto:P,fetchProyecto:p,proyectos:S,deleteProyecto:F,updateProyecto:k}=M(),{empleados:f,fetchEmpleado:I}=J(),[C,b]=i.useState(null),[d,v]=i.useState({ID_Empleados:"",Lugar:"",URL:""}),[l,x]=i.useState({ID_Empleados:"",Lugar:"",URL:""}),[u,g]=i.useState([]),[o,h]=i.useState(!1),[Re,q]=i.useState(0),[w,j]=i.useState([]),[y,_]=i.useState([]),[U,m]=i.useState([]),A="bradatec",G="davbpytad",E=i.useCallback(async()=>{await Promise.all([p(),I()])},[p,I]);i.useEffect(()=>{E()},[E]);const R=async t=>{q(0);const r=new FormData;r.append("file",t),r.append("upload_preset",A);try{const s=await fetch(`https://api.cloudinary.com/v1_1/${G}/image/upload`,{method:"POST",body:r});if(!s.ok)throw new Error("Error al subir imagen a Cloudinary");return(await s.json()).secure_url}catch(s){throw console.error("Error en upload:",s),s}},B=t=>{const r=Array.from(t.target.files);if(r.length>0){const s=r[0];g([s]),v(c=>({...c,URL:""}));const n=new FileReader;n.onload=c=>{j([c.target.result])},n.readAsDataURL(s)}},O=t=>{const r=Array.from(t.target.files);if(r.length>0){const s=r[0];_([s]),x(c=>({...c,URL:""}));const n=new FileReader;n.onload=c=>{m([c.target.result])},n.readAsDataURL(s)}},$=()=>{g([]),j([])},H=()=>{_([]),m([])},N=t=>{const{name:r,value:s}=t.target;if(r==="URL"&&s.trim()!==""){g([]),j([]);const n=document.querySelector('input[type="file"]');n&&(n.value="")}v(n=>({...n,[r]:s}))},T=async t=>{t.preventDefault(),h(!0);try{let r={...d};if(u.length>0){const n=await R(u[0]);r.URL=n}await P(r),v({ID_Empleados:"",Lugar:"",URL:""}),g([]),j([]);const s=document.querySelector('input[type="file"]');s&&(s.value=""),await p()}catch(r){console.error("Error adding project:",r),alert("Error al crear el proyecto. Verifica tu configuraci√≥n de Cloudinary.")}finally{h(!1),q(0)}},z=async t=>{if(window.confirm("¬øEst√°s seguro de que quieres eliminar este proyecto?"))try{await F(t),await p()}catch(r){console.error("Error deleting project:",r)}},V=t=>{b(t),x({ID_Empleados:t.ID_Empleados,Lugar:t.Lugar,URL:t.URL}),_([]),m([])},L=t=>{const{name:r,value:s}=t.target;if(r==="URL"&&s.trim()!==""){_([]),m([]);const n=document.querySelector('.modal input[type="file"]');n&&(n.value="")}x(n=>({...n,[r]:s}))},Y=async()=>{h(!0);try{let t={...l};if(y.length>0){const r=await R(y[0]);t.URL=r}await k(C.ID_Proyectos,t),await p(),b(null),_([]),m([])}catch(t){console.error("Error updating project:",t),alert("Error al actualizar el proyecto.")}finally{h(!1)}},D=()=>{b(null),_([]),m([])};return e.jsxs("div",{className:a.container,children:[e.jsxs("div",{className:a.formSection,children:[e.jsx("h1",{className:a.title,children:"Agregar proyectos"}),e.jsx("div",{className:a.configAlert,children:e.jsxs("p",{children:[e.jsx("strong",{children:"‚ö†Ô∏è Configuraci√≥n:"})," Cloudinary configurado para subida de im√°genes"]})}),e.jsxs("form",{onSubmit:T,className:a.form,children:[e.jsxs("select",{name:"ID_Empleados",value:d.ID_Empleados,onChange:N,required:!0,className:a.form__select,disabled:o,children:[e.jsx("option",{value:"",children:"-- Seleccionar empleado --"}),f.map(t=>e.jsx("option",{value:t.ID_Empleado,children:t.Nombre_Empleado},t.ID_Empleado))]}),e.jsx("input",{type:"text",placeholder:"Ingrese lugar",required:!0,name:"Lugar",value:d.Lugar,onChange:N,className:a.form__input,disabled:o}),e.jsx("input",{type:"text",placeholder:"Ingrese URL del proyecto (o sube una imagen abajo)",required:!0,name:"URL",value:d.URL,onChange:N,className:a.form__input,disabled:o||u.length>0,title:u.length>0?"Deshabilitado porque hay una imagen seleccionada":""}),e.jsxs("div",{className:a.imageUploadSection,children:[e.jsx("label",{className:a.fileLabel,children:"üì∏ O sube una imagen del proyecto"}),e.jsx("input",{type:"file",accept:"image/*",onChange:B,className:a.fileInput,disabled:o||d.URL.trim()!=="",title:d.URL.trim()!==""?"Deshabilitado porque hay una URL ingresada":""}),e.jsx("p",{className:a.fileHint,children:"Puedes ingresar una URL O subir una imagen, no ambas. La imagen se guardar√° como URL en la base de datos."})]}),w.length>0&&e.jsxs("div",{className:a.previewContainer,children:[e.jsx("label",{children:"Vista previa de la imagen:"}),e.jsx("div",{className:a.previewGrid,children:e.jsxs("div",{className:a.previewItem,children:[e.jsx("img",{src:w[0],alt:"Preview",className:a.previewImage}),e.jsx("button",{type:"button",onClick:$,className:a.removeBtn,disabled:o,children:"‚ùå"})]})})]}),o&&e.jsxs("div",{className:a.uploadProgress,children:[e.jsx("p",{children:"Procesando proyecto y subiendo imagen..."}),e.jsx("div",{className:a.progressBar,children:e.jsx("div",{className:a.progressFill})})]}),e.jsx("button",{type:"submit",className:a.form__button,disabled:o,children:o?"Guardando...":"Guardar Proyecto"})]})]}),e.jsxs("div",{className:a.listSection,children:[e.jsx("h1",{className:a.title,children:"Lista de Proyectos"}),e.jsx("div",{className:a.projectsGrid,children:S.map(t=>{var r;return e.jsxs("div",{className:a.projectCard,children:[e.jsxs("div",{className:a.projectInfo,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Empleado:"})," ",((r=f.find(s=>s.ID_Empleado===t.ID_Empleados))==null?void 0:r.Nombre_Empleado)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Lugar:"})," ",t.Lugar]}),e.jsxs("p",{children:[e.jsx("strong",{children:"URL:"}),e.jsx("a",{href:t.URL,target:"_blank",rel:"noopener noreferrer",className:a.projectLink,children:t.URL})]})]}),t.URL&&e.jsx("div",{className:a.projectImage,children:e.jsx("img",{src:t.URL,alt:`Proyecto ${t.ID_Proyectos}`,className:a.projectImg,onError:s=>{s.target.style.display="none"},onLoad:s=>{s.target.style.display="block"}})}),e.jsxs("div",{className:a.projectCard__actions,children:[e.jsx("button",{onClick:()=>V(t),className:a.projectCard__button,disabled:o,children:"Editar"}),e.jsx("button",{onClick:()=>z(t.ID_Proyectos),className:`${a.projectCard__button} ${a["projectCard__button--delete"]}`,disabled:o,children:"Eliminar"})]})]},t.ID_Proyectos)})})]}),C&&e.jsx("div",{className:a.modal,children:e.jsxs("div",{className:a.modal__content,children:[e.jsx("span",{className:a.modal__close,onClick:D,children:"√ó"}),e.jsx("h3",{className:a.modal__title,children:"Editar proyecto"}),e.jsxs("select",{name:"ID_Empleados",value:l.ID_Empleados,onChange:L,className:a.modal__input,required:!0,disabled:o,children:[e.jsx("option",{value:"",children:"-- Seleccionar empleado --"}),f.map(t=>e.jsx("option",{value:t.ID_Empleado,children:t.Nombre_Empleado},t.ID_Empleado))]}),e.jsx("input",{type:"text",name:"Lugar",value:l.Lugar,onChange:L,placeholder:"Lugar",className:a.modal__input,required:!0,disabled:o}),e.jsx("input",{type:"text",name:"URL",value:l.URL,onChange:L,placeholder:"URL del proyecto (o sube una imagen abajo)",className:a.modal__input,required:!0,disabled:o||y.length>0,title:y.length>0?"Deshabilitado porque hay una imagen seleccionada":""}),l.URL&&e.jsxs("div",{className:a.currentImageSection,children:[e.jsx("label",{children:"Imagen actual:"}),e.jsx("div",{className:a.currentImageContainer,children:e.jsx("img",{src:l.URL,alt:"Imagen actual",className:a.currentImage,onError:t=>{t.target.style.display="none"}})})]}),e.jsxs("div",{className:a.newImageSection,children:[e.jsx("label",{children:"O cambiar por nueva imagen:"}),e.jsx("input",{type:"file",accept:"image/*",onChange:O,className:a.fileInput,disabled:o||l.URL.trim()!=="",title:l.URL.trim()!==""?"Limpie la URL primero para subir una nueva imagen":""}),e.jsx("p",{className:a.fileHint,children:"Limpie la URL arriba si quiere subir una nueva imagen"})]}),U.length>0&&e.jsxs("div",{className:a.newPreviewContainer,children:[e.jsx("label",{children:"Nueva imagen:"}),e.jsx("div",{className:a.previewGrid,children:e.jsxs("div",{className:a.previewItem,children:[e.jsx("img",{src:U[0],alt:"Nueva imagen",className:a.previewImage}),e.jsx("button",{type:"button",onClick:H,className:a.removeBtn,disabled:o,children:"‚ùå"})]})})]}),o&&e.jsxs("div",{className:a.uploadProgress,children:[e.jsx("p",{children:"Actualizando proyecto..."}),e.jsx("div",{className:a.progressBar,children:e.jsx("div",{className:a.progressFill})})]}),e.jsxs("div",{className:a.modal__buttons,children:[e.jsx("button",{onClick:Y,className:a.modal__button,disabled:o,children:o?"Guardando...":"Guardar Cambios"}),e.jsx("button",{onClick:D,className:`${a.modal__button} ${a["modal__button--cancel"]}`,disabled:o,children:"Cancelar"})]})]})})]})};export{Pe as default};
